import{next as nextId}from"./id-sequence.min.js";const methods={initialize(){return this._id=nextId("eventful-"),this._events={},this._listeningTo={},this},terminate(){this.off(),this.stopListeningTo(),this.trigger("terminate")},on(e,t,i){return this._events[e]||(this._events[e]=[]),this._events[e].push({callback:t,owner:i}),i&&(i._listeningTo[this._id]||(i._listeningTo[this._id]={}),i._listeningTo[this._id][e]||(i._listeningTo[this._id][e]=[]),i._listeningTo[this._id][e].push({other:this,callback:t})),this},off(e,t,i){const s=e=>{const s=this._events[e];let n=0;for(;n<s.length;){const r=s[n];if(null!=t&&r.callback!==t||null!=i&&r.owner!==i)n++;else{if(s.splice(n,1),i&&i._listeningTo[this._id]&&i._listeningTo[this._id][e]){const s=i._listeningTo[this._id][e];let n=0;for(;n<s.length;){const i=s[n];if(i.other!==this||i.callback!==t)n++;else if(s.splice(n,1),e&&t)break}}if(e&&t)break}}0===this._events[e].length&&delete this._events[e]};if(e)this._events[e]&&s(e);else for(const e in this._events)s(e);return this},trigger(e,...t){if(this._events[e]){const i=[...this._events[e]];for(let e=0,s=i.length;e<s;e++){i[e].callback.call(this,...t)}}return this},listenTo(e,t,i){return e.on(t,i,this),this},stopListeningTo(e,t,i){const s=(e,t)=>{const s=[...this._listeningTo[e][t]];for(let e=0,n=s.length;e<n;e++){s[e].other.off(t,i,this)}},n=e=>{const i=this._listeningTo[e];if(t)i[t]&&s(e,t);else for(const t in i)s(e,t)};if(e)this._listeningTo[e._id]&&n(e._id);else for(const e in this._listeningTo)n(e);return this}},propertyDescriptors={_id:{writable:!0},_events:{writable:!0},_listeningTo:{writable:!0},initialize:{enumerable:!0,value:methods.initialize},terminate:{enumerable:!0,value:methods.terminate},on:{enumerable:!0,value:methods.on},off:{enumerable:!0,value:methods.off},trigger:{enumerable:!0,value:methods.trigger},listenTo:{enumerable:!0,value:methods.listenTo},stopListeningTo:{enumerable:!0,value:methods.stopListeningTo}},eventTargetMethods=Object.assign({},methods,{initialize(e=this){return this._eventTarget=e,this._listeners={},methods.initialize.call(this)},on(e,t,i){return methods.on.call(this,e,t,i),this._listeners[e]||(this._listeners[e]=(...t)=>{this.trigger(e,...t)},this._eventTarget.addEventListener(e,this._listeners[e])),this},off(e,t,i){methods.off.call(this,e,t,i);const s=e=>{this._eventTarget.removeEventListener(e,this._listeners[e]),this._listeners[e]=null};if(e)!this._listeners[e]||this._events[e]&&0!==this._events[e].length||s(e);else for(const t in this._listeners)this._events[e]&&0!==this._events[e].length||s(t);return this}}),eventTargetPropertyDescriptors=Object.assign({},propertyDescriptors,{_listeners:{writable:!0},initialize:{enumerable:!0,value:eventTargetMethods.initialize},on:{enumerable:!0,value:eventTargetMethods.on},off:{enumerable:!0,value:eventTargetMethods.off}});function factory(e){return e instanceof EventTarget?Object.defineProperties(e,eventTargetPropertyDescriptors):Object.defineProperties(e,propertyDescriptors)}export{methods,propertyDescriptors,eventTargetMethods,eventTargetPropertyDescriptors,factory};
//# sourceMappingURL=eventful.min.js.map
