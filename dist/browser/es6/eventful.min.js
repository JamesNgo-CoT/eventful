const Eventful=(()=>{const{next:e}=IdSequence,t={initialize(t=this){return this._context=t,this._id=e("eventful-"),this._events={},this._listeningTo={},this},terminate(){this.off(),this.stopListeningTo(),this.trigger("terminate")},on(e,t,i){return this._events[e]||(this._events[e]=[]),this._events[e].push({callback:t,owner:i}),i&&(i._listeningTo[this._id]||(i._listeningTo[this._id]={}),i._listeningTo[this._id][e]||(i._listeningTo[this._id][e]=[]),i._listeningTo[this._id][e].push({other:this,callback:t})),this},off(e,t,i){const n=e=>{const n=this._events[e];let s=0;for(;s<n.length;){const l=n[s];if(null!=t&&l.callback!==t||null!=i&&l.owner!==i)s++;else{if(n.splice(s,1),i&&i._listeningTo[this._id]&&i._listeningTo[this._id][e]){const n=i._listeningTo[this._id][e];let s=0;for(;s<n.length;){const i=n[s];if(i.other!==this||i.callback!==t)s++;else if(n.splice(s,1),e&&t)break}}if(e&&t)break}}0===this._events[e].length&&delete this._events[e]};if(e)this._events[e]&&n(e);else for(const e in this._events)n(e);return this},trigger(e,...t){if(this._events[e]){const i=[...this._events[e]];for(let e=0,n=i.length;e<n;e++){i[e].callback.call(this,...t)}}return this},listenTo(e,t,i){return e.on(t,i,this),this},stopListeningTo(e,t,i){const n=(e,t)=>{const n=[...this._listeningTo[e][t]];for(let e=0,s=n.length;e<s;e++){n[e].other.off(t,i,this)}},s=e=>{const i=this._listeningTo[e];if(t)i[t]&&n(e,t);else for(const t in i)n(e,t)};if(e)this._listeningTo[e._id]&&s(e._id);else for(const e in this._listeningTo)s(e);return this}},i={_context:{writable:!0},_id:{writable:!0},_events:{writable:!0},_listeningTo:{writable:!0},initialize:{enumerable:!0,value(){return t.initialize.call(this)}},terminate:{enumerable:!0,value:t.terminate},on:{enumerable:!0,value:t.on},off:{enumerable:!0,value:t.off},trigger:{enumerable:!0,value:t.trigger},listenTo:{enumerable:!0,value:t.listenTo},stopListeningTo:{enumerable:!0,value:t.stopListeningTo}},n=Object.assign({},t,{initialize(e){return this._listeners={},t.initialize.call(this,e)},on(e,i,n){return t.on.call(this,e,i,n),this._listeners[e]||(this._listeners[e]=(...t)=>{this.trigger(e,...t)},this._context.addEventListener(e,this._listeners[e])),this},off(e,i,n){t.off.call(this,e,i,n);const s=e=>{this._context.removeEventListener(e,this._listeners[e]),this._listeners[e]=null};if(e)!this._listeners[e]||this._events[e]&&0!==this._events[e].length||s(e);else for(const t in this._listeners)this._events[e]&&0!==this._events[e].length||s(t);return this}}),s=Object.assign({},i,{_listeners:{writable:!0},initialize:{enumerable:!0,value(){return n.initialize.call(this)}},on:{enumerable:!0,value:n.on},off:{enumerable:!0,value:n.off}});return{methods:t,propertyDescriptors:i,eventTargetMethods:n,eventTargetPropertyDescriptors:s,wrap:function(e){return e instanceof EventTarget?{...n}.initialize(e):{...t}.initialize(e)},implement:function(e){return e instanceof EventTarget?Object.defineProperties(e,s).initialize():Object.defineProperties(e,i).initialize()}}})();
//# sourceMappingURL=eventful.min.js.map
